# è¿™æ˜¯ä¸€ä¸ªç®€å•çš„è‡ªåŠ¨åŒ–å·¥ä½œæµ
# æ¯æ¬¡ä½ æ¨é€ä»£ç æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨è¿è¡Œæµ‹è¯•å’Œæ„å»º

name: ç®€å•çš„ä»£ç æ£€æŸ¥

# ä»€ä¹ˆæ—¶å€™è¿è¡Œè¿™ä¸ªå·¥ä½œæµ
on:
  push:
    branches: [main] # åªæœ‰æ¨é€åˆ°mainåˆ†æ”¯æ—¶æ‰è¿è¡Œ
  pull_request:
    branches: [main] # æœ‰äººæƒ³åˆå¹¶ä»£ç åˆ°mainæ—¶ä¹Ÿè¿è¡Œ

# è¦åšçš„å·¥ä½œ
jobs:
  # æ£€æŸ¥åç«¯
  check-backend:
    name: æ£€æŸ¥åç«¯ä»£ç 
    runs-on: ubuntu-latest # åœ¨Linuxç³»ç»Ÿä¸Šè¿è¡Œ

    steps:
      # ç¬¬1æ­¥ï¼šä¸‹è½½ä½ çš„ä»£ç 
      - name: ğŸ“¥ ä¸‹è½½ä»£ç 
        uses: actions/checkout@v4

      # ç¬¬2æ­¥ï¼šå®‰è£…Node.js
      - name: ğŸ”§ å®‰è£…Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      # ç¬¬3æ­¥ï¼šå®‰è£…åç«¯ä¾èµ–
      - name: ğŸ“¦ å®‰è£…åç«¯ä¾èµ–
        run: |
          cd back
          npm install

      # ç¬¬4æ­¥ï¼šæ£€æŸ¥ä»£ç æ˜¯å¦èƒ½æ„å»º
      - name: ğŸ—ï¸ å°è¯•æ„å»ºåç«¯
        run: |
          cd back
          npm run build || echo "æ„å»ºå¤±è´¥ï¼Œä½†ç»§ç»­è¿è¡Œ"
        continue-on-error: true # å³ä½¿å¤±è´¥ä¹Ÿç»§ç»­

      # ç¬¬5æ­¥ï¼šè¿è¡Œæµ‹è¯•ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
      - name: ğŸ§ª è¿è¡Œæµ‹è¯•
        run: |
          cd back
          npm run test || echo "æ²¡æœ‰æµ‹è¯•æˆ–æµ‹è¯•å¤±è´¥"
        continue-on-error: true

  # æ£€æŸ¥å‰ç«¯
  check-frontend:
    name: æ£€æŸ¥å‰ç«¯ä»£ç 
    runs-on: ubuntu-latest

    steps:
      # ç¬¬1æ­¥ï¼šä¸‹è½½ä½ çš„ä»£ç 
      - name: ğŸ“¥ ä¸‹è½½ä»£ç 
        uses: actions/checkout@v4

      # ç¬¬2æ­¥ï¼šå®‰è£…Node.js
      - name: ğŸ”§ å®‰è£…Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      # ç¬¬3æ­¥ï¼šå®‰è£…å‰ç«¯ä¾èµ–
      - name: ğŸ“¦ å®‰è£…å‰ç«¯ä¾èµ–
        run: |
          cd frontier
          npm install

      # ç¬¬4æ­¥ï¼šæ£€æŸ¥ä»£ç æ˜¯å¦èƒ½æ„å»º
      - name: ğŸ—ï¸ å°è¯•æ„å»ºå‰ç«¯
        run: |
          cd frontier
          npm run build || echo "æ„å»ºå¤±è´¥ï¼Œä½†ç»§ç»­è¿è¡Œ"
        continue-on-error: true

      # ç¬¬5æ­¥ï¼šè¿è¡Œä»£ç æ£€æŸ¥ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
      - name: ğŸ” æ£€æŸ¥ä»£ç è´¨é‡
        run: |
          cd frontier
          npm run lint || echo "æ²¡æœ‰ä»£ç æ£€æŸ¥æˆ–æ£€æŸ¥å¤±è´¥"
        continue-on-error: true

  # å¦‚æœå‰é¢éƒ½æˆåŠŸï¼Œæ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
  success:
    name: âœ… æ‰€æœ‰æ£€æŸ¥å®Œæˆ
    runs-on: ubuntu-latest
    needs: [check-backend, check-frontend] # ç­‰å‰é¢ä¸¤ä¸ªå®Œæˆ

    steps:
      - name: ğŸ‰ æ­å–œ
        run: |
          echo "ğŸ‰ æ­å–œï¼ä½ çš„ä»£ç é€šè¿‡äº†æ‰€æœ‰åŸºæœ¬æ£€æŸ¥"
          echo "ğŸ’¡ è¿™æ„å‘³ç€ï¼š"
          echo "   - ä»£ç å¯ä»¥æ­£å¸¸ä¸‹è½½"
          echo "   - ä¾èµ–å¯ä»¥æ­£å¸¸å®‰è£…"
          echo "   - å‰åç«¯éƒ½å¯ä»¥æ„å»º"
          echo "ğŸš€ æ¥ä¸‹æ¥ä½ å¯ä»¥è€ƒè™‘æ·»åŠ æ›´å¤šè‡ªåŠ¨åŒ–åŠŸèƒ½ï¼"
